# 2024-05-16

See [Instructions](https://15445.courses.cs.cmu.edu/spring2024/project0/) for Project #0.

## Cloning Repository

I cloned the repository with

```sh
git clone https://github.com/cmu-db/bustub.git bustub-clone
```

I renamed it `bustub-clone`.

After that I removed the `.git` directory.

```sh
cd bustub-clone
rm -rf .git
```

## Development Environment

To install the required packages, I ran

```sh
./build_support/packages.sh
```

I note that the bash script installs LLVM 14 using Homebrew.
Before the installation, the LLVM I had was 18. 

Built the project as instructed:

```sh
mkdir build
cd build
cmake -DCMAKE_BUILD_TYPE=Debug ..
make -j 8
```

I replaced `nproc` in the last command with `8` to use 8 cores (total number of CPUs on my device).
It took about 24 seconds to build.


## Coding Style

- Class names: UpperCamelCase
- Class members: snake_case_ with trailing underscores
- Class methods: UpperCamelCase
- Getters: Access class members using getters, which have the `Get` prefix, e.g., `GetChildExecutor` to access the member `child_executor_`.
- Struct names: UpperCamelCase
- Struct members: snake_case_ with trailing underscores
- Enum variables: All CAPS with underscores
- Function arguments: UpperCamelCase


## Task #1 - ORSet

### Testing

Assuming in the project root directory, 
every time to test the project, I ran
```sh
cd build
make orset_test -j 8
./test/orset_test
```

Of course, all tests failed the first time I ran it since I had not implemented anything.


### Data Structure

I referred to
a Rust implementation: [ORSet](https://github.com/andrewjstone/orset/tree/master).

`ORSet` contains 2 members
- `adds`: `map<T, set<uid_t>>` (element set in the paper)
- `removes`: `map<T, set<uid_t>>` (tombstone set in the paper)

In the paper, each of 2 sets in the ORSet consists of tuples like `(element, uid)`.
So, the set should be like `{(e1, n1), (e2, n2)...}` where `e`'s may be duplicated, and `n`'s are unique.

In my implementation, each of `adds` and `removes` is a map that maps an element to a set of IDs.

### Unique ID of the Element

Defined in `orset_driver.h`, class `ORSetDriver` has a member `next_uid_` that will increase from 0. 
Each time its method `GenerateUid` is called, it returns `next_uid_++`, which first increments `next_uid_` and then returns it.

Class `ORSetDriver` should be instantiated only once in the whole program.

## Task #2 - SQL String Functions

### `Compute` Method of `StringExpression`

Need to include 
- `<algorithm>` for `transform`, and 
- `<cctype>` for `tolower` and `toupper`

You must make a clone of the input string since the method is `const`, and the `transform` function will modify the string.

```cpp
auto Compute(const std::string &val) const -> std::string {
  // Make a copy the value string
  std::string val_clone = val;

  // Decide how to process the string based on the expression type
  switch (expr_type_) {
    case StringExpressionType::Lower:
      std::transform(val_clone.begin(), val_clone.end(), val_clone.begin(), ::tolower);
      break;

    case StringExpressionType::Upper:
      std::transform(val_clone.begin(), val_clone.end(), val_clone.begin(), ::toupper);
      break;

    default:
      break;
  }

  return val_clone;
}
```

### Testing

#### First Test

```sh
./bin/bustub-sqllogictest ../test/sql/p0.01-lower-upper.slt --verbose
```

```

Exception Type :: Not implemented, Message :: DiskScheduler is not implemented yet. If you have finished implementing the disk scheduler, please remove the throw exception line in `disk_scheduler.cpp`.

BufferPoolManager is not implemented, only mock tables are supported.
<main>:1
select upper('CMU 15-445 Database Systems');
--- YOUR RESULT ---
CMU 15-445 DATABASE SYSTEMS

--- EXPECTED RESULT ---
CMU 15-445 DATABASE SYSTEMS

<main>:6
select lower('CMU 15-445 Database Systems');
--- YOUR RESULT ---
cmu 15-445 database systems

--- EXPECTED RESULT ---
cmu 15-445 database systems

<main>:11
select lower('CMU 15-445 Database Systems'), '|', upper('CMU 15-445 Database Systems');
--- YOUR RESULT ---
cmu 15-445 database systems | CMU 15-445 DATABASE SYSTEMS

--- EXPECTED RESULT ---
cmu 15-445 database systems | CMU 15-445 DATABASE SYSTEMS

<main>:17
select lower(upper(upper(lower(lower('CMU 15-445 Database Systems'))))), '|', upper(upper(lower(lower('CMU 15-445 Database Systems'))));
--- YOUR RESULT ---
cmu 15-445 database systems | CMU 15-445 DATABASE SYSTEMS

--- EXPECTED RESULT ---
cmu 15-445 database systems | CMU 15-445 DATABASE SYSTEMS

```

#### Second Test

```sh
./bin/bustub-sqllogictest ../test/sql/p0.02-function-error.slt --verbose
```

```
nction-error.slt --verbose

Exception Type :: Not implemented, Message :: DiskScheduler is not implemented yet. If you have finished implementing the disk scheduler, please remove the throw exception line in `disk_scheduler.cpp`.

BufferPoolManager is not implemented, only mock tables are supported.
<main>:1
select upper(1);
ERROR: unexpected arg
libc++abi: terminating
[1]    32673 abort      ./bin/bustub-sqllogictest ../test/sql/p0.02-function-error.slt --verbose
```

Note that it throws `"unexpected arg"` error, which is as expected.

#### Third Test

```sh
./bin/bustub-sqllogictest ../test/sql/p0.03-string-scan.slt --verbose
```

```

Exception Type :: Not implemented, Message :: DiskScheduler is not implemented yet. If you have finished implementing the disk scheduler, please remove the throw exception line in `disk_scheduler.cpp`.

BufferPoolManager is not implemented, only mock tables are supported.
<main>:1
select day_of_week, upper(day_of_week), lower(day_of_week), has_lecture from __mock_table_schedule;
--- YOUR RESULT ---
Monday MONDAY monday 1
Tuesday TUESDAY tuesday 0
Wednesday WEDNESDAY wednesday 1
Thursday THURSDAY thursday 0
Friday FRIDAY friday 0
Saturday SATURDAY saturday 0
Sunday SUNDAY sunday 0

--- EXPECTED RESULT ---
Monday MONDAY monday 1
Tuesday TUESDAY tuesday 0
Wednesday WEDNESDAY wednesday 1
Thursday THURSDAY thursday 0
Friday FRIDAY friday 0
Saturday SATURDAY saturday 0
Sunday SUNDAY sunday 0

```